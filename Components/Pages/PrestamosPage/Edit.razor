@page "/Prestamos/Edit/{PrestamoId:int}"
@rendermode InteractiveServer
@inject PrestamoService prestamoService
@inject DeudorService deudorService
@inject NavigationManager navigation


<PageTitle>Editar prestamo</PageTitle>

<EditForm Model="Prestamo" OnValidSubmit="Modificar">
    <DataAnnotationsValidator />
    <div class="container">
        <div class="card shadow-lg">

            <div class="card-header text-center">
                <h5 class="card-title">Editar prestamo</h5>
            </div>
            <div class="card-body">
                @*ID*@
                <label for="id" class="form-label">ID</label>
                <InputNumber id="id" class="form-control" @bind-Value="Prestamo.PrestamoId" readonly />

                @*Deudor*@
                <label id="deudor" class="form-label"> Deudor</label>
                <InputSelect id="deudor" class="form-select" @bind-Value="Prestamo.DeudorId">
                    <option value="0"> Elija una opci&oacute;n</option>
                    @foreach (var deudor in ListaDeudores)
                    {
                        <option value="@deudor.DeudorId"> @deudor.Nombres</option>

                    }
                </InputSelect>
                <ValidationMessage For="@(()=>Prestamo.DeudorId)"> </ValidationMessage>

                @*Concepto*@
                <label for="concepto" class="form-label"> Concepto</label>
                <InputText id="concepto" class="form-control" @bind-Value="Prestamo.Concepto" @onfocus="LimpiarMensaje"> </InputText>
                <ValidationMessage For="@(()=>Prestamo.Concepto)"> </ValidationMessage>


                @*Monto*@
                <label for="monto" class="form-label">Monto</label>
                <InputNumber id="monto" class="form-control" @bind-Value="Prestamo.Monto" @onfocus="LimpiarMensaje" />
                <ValidationMessage For="@(()=>Prestamo.Monto)"> </ValidationMessage>
            </div>

            <div class="card-footer">
                @if (!string.IsNullOrEmpty(CheckMessage))
                {
                    <div class="alert alert-success bi bi-check2-circle"> @CheckMessage</div>
                }


                <a href="/Prestamos/Index"
                   class="btn btn-outline-secondary">
                    <span class="bi bi-arrow-left mt-3"></span> Volver
                </a>
                <button class="btn btn-outline-success bi bi-pencil-square" type="submit"> Modificar</button>
            </div>
        </div>
    </div>
</EditForm>


@code {
    [Parameter]
    public int PrestamoId { get; set; }
    public Prestamos Prestamo { get; set; } = new Prestamos();
    public string CheckMessage { get; set; }
    public List<Deudores> ListaDeudores { get; set; } = new List<Deudores>();

    protected override async Task OnInitializedAsync()
    {
        if (PrestamoId > 0)
        {
            Prestamo = await prestamoService.Buscar(PrestamoId);
            ListaDeudores = await deudorService.Listar(d => d.DeudorId > 0);
        }
    }

    public async Task Modificar()
    {
        await prestamoService.Guardar(Prestamo);
        CheckMessage = "El prestamo se ha modificado correctamente";
    }

    public void LimpiarMensaje()
    {
        CheckMessage = string.Empty;
    }

}
